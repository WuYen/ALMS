@model List<ALMS.ViewModels.TR01.TR01BModel>
    
@{
    var grid = Html.DevExpress().GridView(settings =>
    {
        BatchGridHelper.GetBasicSetting(settings, "DetailGrid", "TR01", "DetailGrid");

        settings.CustomActionRouteValues = new { Controller = "TR01", Action = "DetailGridBatchUpdate" };
        settings.SettingsEditing.BatchUpdateRouteValues = new { Controller = "TR01", Action = "DetailGridBatchUpdate" };
        settings.SettingsEditing.Mode = GridViewEditingMode.Batch;
        settings.SettingsEditing.BatchEditSettings.EditMode = GridViewBatchEditMode.Cell;
        settings.SettingsEditing.BatchEditSettings.StartEditAction = GridViewBatchStartEditAction.Click;
        settings.SettingsEditing.BatchEditSettings.HighlightDeletedRows = true;
        settings.SettingsEditing.BatchEditSettings.ShowConfirmOnLosingChanges = true;

        BatchGridHelper.SetCommandColumn(settings, true);

        settings.CommandColumn.SetHeaderTemplateContent(c =>
        {
            Html.DevExpress().Button(btn =>
            {
                btn.Name = "BtnDetailAddNew";
                btn.ClientSideEvents.Click = "BtnDetailAddNewClick";
                btn.Text = "新增";
                //btn.Images.Image.Url = "~/Content/Icon/add_circle_outline_grey_18x18.png";
                btn.Styles.Style.Paddings.PaddingTop = 0;
                btn.Styles.Style.Paddings.PaddingBottom = 0;
                btn.Styles.Style.Paddings.PaddingLeft = 0;
                btn.Styles.Style.Paddings.PaddingRight = 0;
            }).GetHtml();
        });

        settings.SettingsCommandButton.DeleteButton.Styles.Style.Paddings.Padding = 0;
        settings.SettingsCommandButton.DeleteButton.Image.IconID = "edit_delete_16x16office2013";
        settings.SettingsCommandButton.DeleteButton.Text = "刪除";

        settings.CommandColumn.ShowRecoverButton = true;

        settings.SettingsCommandButton.RenderMode = GridCommandButtonRenderMode.Button;

        settings.Settings.ShowFooter = false;

        settings.KeyFieldName = "BA02B_ID";

        //settings.Columns.Add(column =>
        //{
        //    BatchGridHelper.SetColumns(column, "BA01A_ID", "科目代碼");
        //    column.EditorProperties().ComboBox(p =>
        //    {
        //        p.TextField = "ACC_NM";
        //        p.ValueField = "BA01A_ID";
        //        p.ValueType = typeof(int);
        //        p.DataSource = CacheCommonDataModule.GetBA01A();
        //    });
        //});
        settings.Columns.Add(column =>
        {
            column.FieldName = "BA01A_ID";
            column.Caption = "科目代碼";
         
            column.ColumnType = MVCxGridViewColumnType.ComboBox;
            var properties = column.PropertiesEdit as ComboBoxProperties;
            properties.DataSource = CacheCommonDataModule.GetBA01A();
            properties.TextField = "ACC_NM";
            properties.ValueField = "BA01A_ID";
            properties.ValueType = typeof(int);
   
            column.SetEditItemTemplateContent(c =>
            {
                Html.RenderPartial("~/Views/TR01/_BA01AGridLookUp.cshtml");
            });
        });

        settings.Columns.Add(column =>
        {
            BatchGridHelper.SetColumns(column, "ACC_NM", "科目名稱");
            column.Settings.ShowEditorInBatchEditMode = false;
            column.ReadOnly = true;
            column.CellStyle.BackColor = System.Drawing.Color.Beige;
            //column.EditorProperties().TextBox(p =>
            //{
            //});
        });
        settings.Columns.Add(column =>
        {
            BatchGridHelper.SetColumns(column, "SUM_RM", "摘要");
            column.EditorProperties().TextBox(p =>
            {
            });
        });

        settings.Columns.Add(column =>
        {
            BatchGridHelper.SetColumns(column, "DEB_MY", "借方");
            column.EditorProperties().SpinEdit(
            p =>
            {
                p.MinValue = 0;
                p.MaxValue = 999999999;
                p.DisplayFormatString = "G29";
            });
        });
        settings.Columns.Add(column =>
        {
            BatchGridHelper.SetColumns(column, "CRE_MY", "貸方");
            column.EditorProperties().SpinEdit(
            p =>
            {
                p.MinValue = 0;
                p.MaxValue = 999999999;
                p.DisplayFormatString = "G29";
            });
        });

        settings.Columns.Add(column =>
        {
            column.FieldName = "IsValid";
            column.Visible = false;
        });

        settings.ClientSideEvents.BeginCallback = "DetailGridBeginCallback";
        settings.ClientSideEvents.EndCallback = "DetailGridEndCallBack";
        settings.ClientSideEvents.BatchEditEndEditing = "DetailGridBatchEndEdit";

        settings.CustomJSProperties += (s, e) =>
        {
            e.Properties["cpErrMsg"] = ViewData["ErrMsg"];
            e.Properties["cpDeleteIDs"] = ViewData["DeleteIDList"];
            e.Properties["cpMasterForm"] = ViewData["MasterForm"];
        };
        settings.CommandButtonInitialize = (s, e) =>//隱藏grid footer 的savechange and cancel link text
        {
            if (e.ButtonType == ColumnCommandButtonType.Update || e.ButtonType == ColumnCommandButtonType.Cancel)
            {
                e.Visible = false;
            }
        };
        settings.Settings.ShowStatusBar = GridViewStatusBarMode.Hidden;
    });
}
@grid.Bind(Model).GetHtml()
